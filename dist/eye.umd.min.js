!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).eye=t()}(this,(function(){"use strict";const e=["put","delete","post","get","patch"],t=()=>{},n="function"==typeof fetch;class r extends Error{constructor(e,t,n,r){super(e),this.name=this.constructor.name,this.status=t||null,this.statusText=n||null,this.stack=(new Error).stack,this.response=r}}function o(e){const t={};if("string"==typeof e)e.trim().split(/[\r\n]+/).forEach((e=>{const n=e.split(": "),r=n.shift(),o=n.join(": ");t[r.toLowerCase()]=o}));else if(e.entries)for(let[n,r]of e.entries())t[n]=r;return t}function s(t,i){if(!t)throw new Error("An api/url must be defined to send an jcall request!");let a=((i=i||{}).method||"post").toLowerCase(),c=i.timeout||null,l=i.credentials||!1,u=i.csrf||s.csrf,d=i.useXHR||!1;if(u&&(l=!0),!0===s.preventer){let e=document.createElement("div");e.style.backgroundColor="rgba(0,0,0,.2)",e.style.position="fixed",e.style.zIndex="10000",e.style.left=e.style.top=0,e.style.width=e.style.height="100%",e.style.display="none",e.open=function(){this.style.display="inline"},e.close=function(){this.style.display="none"},s.preventer=e}let h=new AbortController,p={api:t,method:a&&-1!=e.indexOf(a)?a:"post",credentials:"boolean"==typeof l&&l,timeout:c?c<10?1e3*c:c<100?100*c:c<1e3?10*c:c:0,headers:{signal:h.signal},csrf:u};function f(e,t,n,o,s){switch(e){case 400:o(new r("400 - Bad Request: The server couldn't understand the request.",400,t,n));break;case 401:o(new r("401 - Unauthorized: Authentication is required, or the provided credentials are incorrect.",401,t,n));break;case 403:o(new r("403 - Forbidden: The server understood the request, but the user doesn't have permission to perform the action.",403,t,n));break;case 404:o(new r("404 - Not Found: The requested resource could not be found on the server.",404,t,n));break;case 500:o(new r("500 - Internal Server Error: The server encountered an unexpected condition.",500,t,n));break;case 502:o(new r("502 - Bad Gateway: The server, while acting as a gateway or proxy, received an invalid response from the upstream server.",502,t,n));break;case 503:o(new r("503 - Service Unavailable: The server is currently unavailable, often due to maintenance or overloading.",503,t,n))}}s.authorization&&(p.headers.authorize=s.authorization);let y={type:!0===d?"XHR":!0===n?"FETCH":"XHR",progress:function(){},setHeaders:function(e){let t={};return e.accept&&-1!=["application/json","application/xml","text/html","text/plain","*/*"].indexOf(e.accept)&&(t.accept=e.accept),e.cache&&("boolean"==typeof e.cache?"XHR"==this.type?t.cache=1==e.cache?"public":"no-cache":t.cache=1==e.cache?"force-cache":"no-cache":"string"==typeof e.cache&&("XHR"!=this.type||-1==["no-cache","no-store","public","private"].indexOf(e.cache)&&0!=e.cache.indexOf("max-age=")?"FETCH"==this.type&&-1!=["default","no-store","no-cache","reload","force-cache","only-if-cached"].indexOf(e.cache)?t.cache=e.cache:console.warn("You are using inproperiate values for ``cache`` attribute!"):t.cache=e.cache)),e.cookie&&(t.cookie=e.cookie),e.referer&&(t.referer=e.referer),e.origin&&(t.origin=e.origin),e.lang&&(t.lang=e.lang),e.authorize&&(t.authorize=e.authorize),"boolean"==typeof e.frame&&(t.frame=!0===e.frame?"SAMEORIGIN":"DENY"),!0===e.nosniff&&(t.nosniff=e.nosniff),e.contentType&&(t.contentType=e.contentType),p.headers=t,this},launch:function(e,t){const{headers:n}=p;let r=p.headers.contentType,i={result:null,response:null,headers:null,contentType:null};return!0!==t&&s.preventer&&s.preventer.open(),new Promise(((t,a)=>{let c=this;var l;if(e instanceof FormData||("string"==typeof e?r="text/plain":!0==("object"==typeof(l=e)&&null!==l&&"[object Object]"===Object.prototype.toString.call(l))&&(r="application/json",e=JSON.stringify(e))),"XHR"===this.type){let l=new XMLHttpRequest;this.xhr=l,l.open(p.method||"post",p.api),l.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.upload.onprogress=function(e){e.percent=e.loaded/e.total*100,"function"==typeof c.progress&&c.progress(e)},"boolean"==typeof p.credentials&&(l.withCredentials=p.credentials),l.timeout=p.timeout,l.responseType="json",p.csrf&&l.setRequestHeader("X-CSRF-TOKEN",p.csrf),r&&l.setRequestHeader("Content-Type",r),n.accept&&l.setRequestHeader("Accept",n.accept),n.cache&&l.setRequestHeader("Cache-Control",n.cache),n.cookie&&l.setRequestHeader("Cookie",n.cookie),n.referer&&l.setRequestHeader("Referer",n.referer),n.origin&&l.setRequestHeader("Origin",n.origin),n.lang&&l.setRequestHeader("Accept-Language",n.lang),n.authorize&&l.setRequestHeader("Authorization",n.authorize),n.frame&&l.setRequestHeader("X-Frame-Options",n.frame),!0===n.nosniff&&l.setRequestHeader("X-Content-Type-Options","nosniff"),l.onreadystatechange=function(e){if(4==this.readyState)if(i.headers=o(this.getAllResponseHeaders()),s.preventer&&s.preventer.close(),200==this.status)try{i.result=JSON.parse(this.response),i.response=this.response,t(i)}catch(e){a("ServerSide Error",this.responseText,this,e)}else f(this.status,this.statusText,this.response,a)},l.onerror=function(e){s.preventer&&s.preventer.close(),a("error",e,this)},l.ontimeout=function(e){s.preventer&&s.preventer.close(),a("timeout",e,this)},l.onabort=function(e){s.preventer&&s.preventer.close(),a("abort",e,this)},l.onprogress=function(e){e.percent=e.loaded/e.total*100,"function"==typeof c.progress&&c.progress(e)},l.send(e)}else{let n;0!=p.timeout&&0!=p.timeout&&(n=setTimeout((function(){s.preventer&&s.preventer.close(),c.abort()}),p.timeout)),p.body=e,p.signal=h.signal,p.credentials=!0===p.credentials?"include":"omit",r&&(p.headers["Content-Type"]=r),p.headers.authorize&&(p.headers.Authorization=p.headers.authorize),p.csrf&&(p.headers["X-CSRF-TOKEN"]=p.csrf),p.cache=fetch(p.api,p).then((async e=>{const{ok:r,status:c,statusText:l,type:u,headers:d}=e;if(clearTimeout(n),s.preventer&&s.preventer.close(),!r)return void f(c,l,await e.json(),a);let h=d.get("Content-Type").split(";")[0];return i.headers=o(d),i.contentType=h,i.response=e,h.includes("application/json")?(i.result=await e.json(),t(i)):h.includes("text/html")||h.includes("text/plain")?(i.result=await e.text(),t(i)):h.includes("image")||h.includes("application/pdf")?e.blob():e.arrayBuffer()})).then((async e=>{if(e instanceof Blob){const e=new FileReader;e.readAsDataURL(blob),e.onloadend=()=>{t(e.result)}}})).catch((e=>{if(s.preventer&&s.preventer.close(),clearTimeout(n),"AbortError"===e.name)return a("timeout");a("error",e)}))}})).finally((e=>{s.after&&s.after(e)}))},abort:function(e){"XHR"==this.request.type?this.xhr.abort():h.abort(e)}};return y=Object.seal(y),y}s.csrf=null,s.authorization=null,s.after=t,s.preventer=null,s.jcallify=function(e,n){let r=null,o=null,i=t,a=t,c={api:function(e){return r=e,this},data:function(e){return o=e,this},success:function(e){return a=e,this},error:function(e){return i=e,this}};return e instanceof HTMLFormElement&&e.addEventListener("submit",(function(t){t.preventDefault();let n=e.getAttribute("method")||"post",c=this.getAttribute("action");if(null!=r&&(c=r(this,c)),!c)throw new Error("Bad setup!\nplease include the action attribute in the form");let l=new FormData(this);null!=o&&(l=o(this,l)),s(c,{method:n}).launch(l).then((e=>{a(e)})).catch((e=>i(e)))})),c},window.jcall=s;const i=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","mouseover","mouseout","contextmenu","keydown","keypress","keyup","focus","blur","focusin","focusout","submit","change","input","reset","select","touchstart","touchend","touchmove","touchcancel","pointerdown","pointerup","pointermove","pointerenter","pointerleave","pointercancel","dragstart","dragend","dragenter","dragover","dragleave","drop","resize","scroll","load","beforeunload","unload","play","pause","ended","volumechange","timeupdate","copy","cut","paste","animationstart","animationend","animationiteration","transitionstart","transitionend","DOMSubtreeModified","DOMNodeInserted","DOMNodeRemoved","error","hashchange","popstate"],a=["base","head","link","meta","style","title","body","address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rp","rt","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","area","audio","img","map","track","video","embed","iframe","object","picture","portal","source","canvas","noscript","script","del","ins","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr","button","datalist","fieldset","form","input","label","legend","meter","optgroup","option","output","progress","select","textarea","details","dialog","summary","slot","template"],c=new WeakMap;function l(e){let t="";for(let n=0;n<e.length;n++){const r=e[n];r===r.toUpperCase()&&r!==r.toLowerCase()?t+="-"+r:t+=r}return t.toLowerCase()}function u(e,t,n){n instanceof Array&&(children=n);let r,o="querySelector",d=void 0===this||this instanceof Window?document:this;if(e instanceof HTMLElement?r=e:(t&&!0===t.all&&(o="querySelectorAll"),d==document&&-1!=a.indexOf(e)&&(o="createElement"),r=d[o](e)),r instanceof NodeList)return r.forEach((e=>u(e))),[...r];if(!r)return null;if(r.isEyeInstance)return r;r.isEyeInstance=!0,r.eye=u,r.setAttrs=function(){},r.show=function(e){return this.style.display=e||"",this},r.hide=function(){return this.style.display="none",this},r.child=function(...e){let t=this;for(let n=0;n<e.length&&(t=t.children[e[n]],t);n++);return u(t)},r.refer=function(e,t){if(void 0!==t){let n=c.get(this);return n||(n={},c.set(this,n)),t instanceof Array?n[e]instanceof Array?n[e].push(t[0]):n[e]=[t[0]]:n[e]=t,this}return c.get(this)?.[e]},r.unrefer=function(e,t){let n=c.get(this);n&&(!t&&"string"==typeof e&&n[e]?n[e]=void 0:"function"==typeof t&&n[e]instanceof Array&&n[e].forEach(((e,n,r)=>{!0===t(e)&&(r.splice(n,1),n--)})))},i.forEach((e=>{var t;"function"==typeof r[e]&&(t=r[e]),r[e]=function(n){return n?"function"==typeof n&&r.addEventListener(e,n):t.call(r),this}})),r.on=function(e,t){e=e instanceof Array?e:[e];for(let n=0;n<e.length;n++)r.addEventListener(e[n],t);return this},r.appendTo=function(e){e&&e.append(this)},r.attr=function(e,t){if(e){if(!t)return this.getAttribute(e);this.setAttribute(e,t)}return this},r.data=function(e,t){if(e){if(!t)return this.dataset[e];this.dataset[e]=t}return this.dataset};let h=null,p=null;if(t)for(const e in t){const n=t[e];if("class"==e)r.classList.add.apply(r.classList,n instanceof Array?n:[n]);else if("text"==e)r.textContent=n;else if("html"==e)r.innerHTML=n;else if("data"==e)for(const e in n)r.dataset[e]=n[e];else"parent"==e?h=n:"refresh"==e?p=n:e in r?r[e]=n:r.setAttribute(e,r)}if(n)for(const e in n)-1!=e.indexOf("-")?r.style[e]=n[e]:r.style[l(e)]=n[e];return r.refresh=function(){if(p){const{request:e,data:t,callback:n}=p;"function"==typeof t&&(t=t()),s(e).launch(t).then((e=>{n(void 0,e)})).catch((e=>{n(e)}))}},h&&h.append(r),r}return window.eye=u,u}));
//# sourceMappingURL=eye.umd.min.js.map
